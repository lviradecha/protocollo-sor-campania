<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genera Attestati - SOR Campania</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Banner con Logo -->
    <header class="banner">
        <div class="banner-content">
            <div class="banner-logo">
                <img src="logo-sor.jpg" alt="Logo SOR Campania">
            </div>
            <div class="banner-text">
                <h1 class="banner-title">CROCE ROSSA ITALIANA</h1>
                <p class="banner-subtitle">Sala Operativa Regionale - Campania | Generazione Attestati</p>
            </div>
            <button onclick="logout()" class="btn-logout">ğŸšª Esci</button>
            <div class="banner-version">v2.0</div>
        </div>
    </header>

    <!-- Navigation Menu -->
    <nav class="nav-menu">
        <div class="nav-content">
            <a href="dashboard.html" class="nav-link">ğŸ“Š Dashboard</a>
            <a href="index.html" class="nav-link">ğŸ“„ Protocollo</a>
            <a href="registro.html" class="nav-link">ğŸ“‹ Registro</a>
            <a href="attestati.html" class="nav-link active">ğŸ“œ Attestati</a>
            <a href="registro-attestati.html" class="nav-link">ğŸ“Š Reg. Attestati</a>
            <a href="admin.html" class="nav-link" id="linkAdmin" style="display: none;">ğŸ‘¥ Utenti</a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container">
        <div class="card">
            <h2>ğŸ“œ Genera Attestati di Partecipazione</h2>
            
            <div class="info-box">
                <p><strong>â„¹ï¸ Generazione automatica:</strong> Carica un file CSV con i partecipanti e genera automaticamente tutti gli attestati in formato PDF.</p>
            </div>

            <form id="attestatiForm">
                <div class="form-group">
                    <label for="csvFile">ğŸ“ File CSV Partecipanti *</label>
                    <input type="file" id="csvFile" accept=".csv" required>
                    <small>Formato: Nome, Cognome, Codice_Fiscale (senza intestazione)</small>
                </div>

                <div class="form-group">
                    <label for="nomeEvento">ğŸ¯ Nome Evento *</label>
                    <input type="text" id="nomeEvento" placeholder="Es: EXE HIRPUS 2025" required>
                </div>

                <div class="form-group">
                    <label for="tipoEvento">ğŸ“‹ Tipo Evento</label>
                    <input type="text" id="tipoEvento" placeholder="ha partecipato all'esercitazione provinciale ad elevata complessitÃ " value="ha partecipato all'esercitazione provinciale ad elevata complessitÃ ">
                    <small>Testo che appare sotto il codice fiscale e prima del nome evento</small>
                </div>

                <div class="form-group">
                    <label for="descrizioneEvento">ğŸ“ Descrizione Evento *</label>
                    <textarea id="descrizioneEvento" rows="5" placeholder="Descrizione dettagliata dell'evento..." required></textarea>
                </div>

                <div class="form-group">
                    <label for="dataConferimento">ğŸ“… Data Conferimento *</label>
                    <input type="date" id="dataConferimento" required>
                </div>

                <div class="form-group" style="display: flex; align-items: center; gap: 10px; padding: 15px; background: #e3f2fd; border-radius: 8px; margin-bottom: 20px;">
                    <input type="checkbox" id="inviaEmail" style="width: 20px; height: 20px; cursor: pointer;">
                    <label for="inviaEmail" style="margin: 0; cursor: pointer; font-weight: 600;">
                        ğŸ“§ Invia attestati via email ai partecipanti
                    </label>
                </div>

                <button type="submit" class="btn-primary" id="btnGenera">
                    ğŸ“œ Genera Attestati
                </button>
            </form>

            <div id="resultSection" class="result" style="display: none;"></div>
            <div id="errorSection" class="error" style="display: none;"></div>
            <div id="progressSection" style="display: none; margin-top: 20px;">
                <progress id="progressBar" value="0" max="100" style="width: 100%;"></progress>
                <p id="progressText" style="text-align: center; margin-top: 10px;">Elaborazione in corso...</p>
            </div>
        </div>

        <div class="card" style="background: #f5f5f5;">
            <h3>ğŸ“‹ Formato File CSV</h3>
            <p>Il file CSV deve contenere <strong>4 colonne</strong> senza intestazione:</p>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px; margin: 20px 0; padding: 15px; background: white; border-radius: 8px; font-weight: 600; text-align: center; border: 2px solid #d32f2f;">
                <div>Nome</div>
                <div>Cognome</div>
                <div>Codice Fiscale</div>
                <div>Email</div>
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <button onclick="scaricaTemplateCSV()" class="btn-primary" style="padding: 12px 30px;">
                    ğŸ“¥ Scarica Template CSV
                </button>
            </div>
            
            <div style="background: #fff3e0; padding: 15px; border-radius: 8px; margin-top: 15px;">
                <p style="margin: 0;"><strong>âš ï¸ Note importanti:</strong></p>
                <ul style="margin: 10px 0 0 20px; padding: 0;">
                    <li>Non includere la riga di intestazione nel file</li>
                    <li>ğŸ“§ Email opzionale: Se non vuoi inviare email, lascia vuoto o usa "N/A"</li>
                    <li>Salva il file come CSV (delimitato da virgole)</li>
                </ul>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>ğŸ“ sor.campania@cri.it | +39 081 7810011 (selezione 2)</p>
        <p class="footer-small">Â© 2025 Croce Rossa Italiana - Comitato Regionale Campania</p>
    </footer>

    <script src="auth.js"></script>
    <script>
        // Mostra link admin solo per admin
        if (sessionStorage.getItem('ruolo') === 'admin') {
            document.getElementById('linkAdmin').style.display = 'flex';
        }
    </script>
    <script src="attestati.js"></script>
</body>
</html>
